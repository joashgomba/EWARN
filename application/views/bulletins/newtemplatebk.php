<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <meta name="viewport" content="width=device-width">
<title>Bulletin</title>
<style>
				#lasttable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#lasttable td, #lasttable th 
				{
				font-size:1.0em;
				border:1px solid #999999;
				padding:3px 7px 2px 7px;
				}
				#lasttable th 
				{
				font-size:1.0em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#lasttable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				
				
				#listtable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:80%;
				border-collapse:collapse;
				}
				#listtable td, #listtable th 
				{
				font-size:1.0em;
				border:1px solid #999999;
				padding:3px 7px 2px 7px;
				}
				#listtable th 
				{
				font-size:1.0em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#listtable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				
				/**/
				#zonlisttable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#zonlisttable td, #zonlisttable th 
				{
				font-size:1.0em;
				border:1px solid #999999;
				padding:3px 7px 2px 7px;
				}
				#zonlisttable th 
				{
				font-size:1.0em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#zonlisttable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                 <style>
        #customers
        {
        font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
        width:100%;
        border-collapse:collapse;
        }
        #customers td, #customers th 
        {
        font-size:0.9em;
        border:2px  solid #fff;
        padding:3px 7px 2px 7px;
        }
        #customers th 
        {
        font-size:1.0em;
        text-align:left;
        padding-top:5px;
        padding-bottom:4px;
        background-color:#cccccc;
        color:#fff;
        }
        #customers tr.alt td 
        {
        color:#000;
        background-color:#cccfff;
        }
        </style>
        
        <style>
				#alertstable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#alertstable td, #alertstable th 
				{
				font-size:0.8em;
				border:1px solid #1F7EB8;
				padding:3px 7px 2px 7px;
				}
				#alertstable th 
				{
				font-size:0.8em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#alertstable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                <style>
				#disttable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#disttable td, #disttable th 
				{
				font-size:0.8em;
				border:1px solid #892A24;
				padding:3px 7px 2px 7px;
				}
				#disttable th 
				{
				font-size:0.8em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#892A24;
				color:#fff;
				}
				#disttable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                
                <style>
				#datatable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#datatable td, #listtable th 
				{
				font-size:0.9em;
				border:1px solid #892A24;
				padding:3px 7px 2px 7px;
				}
				#datatable th 
				{
				font-size:0.9em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#892A24;
				color:#fff;
				}
				#datatable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                
        
      
    <style>
    #map-canvas{
      width: 500px;
      height: 360px;
	    padding: 6px;
        border-width: 1px;
        border-style: solid;
        border-color: #ccc #ccc #999 #ccc;
        -webkit-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        -moz-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        box-shadow: rgba(64, 64, 64, 0.1) 0 2px 5px;
    }
	
	img { max-width:none; }
  </style>

<style>
    #map-canvas{
      width: 500px;
      height: 360px;
	    padding: 6px;
        border-width: 1px;
        border-style: solid;
        border-color: #ccc #ccc #999 #ccc;
        -webkit-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        -moz-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        box-shadow: rgba(64, 64, 64, 0.1) 0 2px 5px;
    }
	
	img { max-width:none; }
</style>
  
<style>
p.mybreak { page-break-before: always; }
</style>
 <script type="text/javascript" language="javascript" src="<?php echo base_url(); ?>media/js/jquery.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
<center>
<table id="listtable" width="100%">
<tr><td><img src="<?php echo base_url(); ?>images/header.png" alt="" width="100%" height=""></td></tr>
<tr bgcolor="#1f7eb8"><th><center>
<font color="#FFFFFF"><strong> Epi Week <?php echo $epicalendar->week_no;?>, <?php echo date("d F Y", strtotime($epicalendar->from)); ?> - <?php echo date("d F Y", strtotime($epicalendar->to)); ?></strong></font></center>
</th></tr>
<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Highlights</strong></font>
		</td>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Cumulative Figures</strong></font>
		</td>
		</tr>
		<tr>
		<td valign="top"><?php echo $highlight;?>
        <input type="hidden" name="country" id="country" value="SOM">
<input type="hidden" name="week_no" id="week_no" value="28">
<input type="hidden" name="week_year" id="week_year" value="2017">
<input type="hidden" name="bulletin_id" id="bulletin_id" value="1">
        
        </td>
		<td valign="top">
		<?php echo $cumulative_figures; ?>

		
		</td>
		</tr>
		</table>

</td>
</tr>

<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Reporting rates vs consultations in <?php echo $country->country_name;?>, Epi Weeks <?php echo $first_week; ?> <?php echo $first_year; ?> to <?php echo $last_week; ?> <?php echo $last_year; ?></strong></font>
		</td>
		
		</tr>
		<tr>
		<td valign="top"><script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'consultationscontainer',
                zoomType: 'xy'
            },
            title: {
                text: ''
            },
			credits: {
      enabled: false
  },
            xAxis: [{
                categories: [<?php echo $categories; ?>]
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    formatter: function() {
                        return this.value ;
                    },
                    style: {
                        color: '#89A54E'
                    }
                },
				gridLineWidth: 0,
				minPadding: 0, 
                maxPadding: 0,         
                min: 0, 
                max:<?php echo $total_facilities; ?>,
                title: {
                    text: 'Reporting Sites',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: 'Consultations',
                    style: {
                        color: '#4572A7'
                    }
                },
                labels: {
                    formatter: function() {
                        return this.value ;
                    },
                    style: {
                        color: '#4572A7'
                    }
                },
                opposite: true
            }],
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +
                        (this.series.name == 'Consultations' ? ' ' : '');
                }
            },
            series: [{
                name: 'Consultations',
                color: '#4572A7',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $consultations_column; ?>]
    
            }, {
                name: 'Reporting Sites',
                color: '#89A54E',
                type: 'spline',
                data: [<?php echo $reporting_sites_column; ?>]
            }]
        });
    });
    
});
		</script>
        
        <div id="consultationscontainer" style="min-width:400px; height: 400px; margin: 0 auto"></div>
        
        <!-- For download from highcharts server-->

<script>
// Regular chart options
// Just never rendered with "new Highcharts.Chart" or "$('#container').highcharts()"
var options = {
    chart: {
               
                zoomType: 'xy'
            },
            title: {
                text: ''
            },
			credits: {
      enabled: false
  },
            xAxis: [{
                categories: [<?php echo $categories; ?>]
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    formatter: function() {
                        return this.value ;
                    },
                    style: {
                        color: '#89A54E'
                    }
                },
				gridLineWidth: 0,
				minPadding: 0, 
                maxPadding: 0,         
                min: 0, 
                max:<?php echo $total_facilities; ?>,
                title: {
                    text: 'Reporting Sites',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: 'Consultations',
                    style: {
                        color: '#4572A7'
                    }
                },
                labels: {
                    formatter: function() {
                        return this.value ;
                    },
                    style: {
                        color: '#4572A7'
                    }
                },
                opposite: true
            }],
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +
                        (this.series.name == 'Consultations' ? ' ' : '');
                }
            },
            series: [{
                name: 'Consultations',
                color: '#4572A7',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $consultations_column; ?>]
    
            }, {
                name: 'Reporting Sites',
                color: '#89A54E',
                type: 'spline',
                data: [<?php echo $reporting_sites_column; ?>]
            }]
};


// URL to Highcharts export server
var exportUrl = 'http://export.highcharts.com/';

// POST parameter for Highcharts export server
var object = {
    options: JSON.stringify(options),
    type: 'image/png',
    async: true
};

// Ajax request
$.ajax({
    type: 'post',
    url: exportUrl,
    data: object,
    success: function (data) {
        // Update "src" attribute with received image URL
        //$('#mychart').attr('src', exportUrl + data);
		
    }
}).done(function(data){
		
		var country = $('#country').val();
		var week_no = $('#week_no').val();
		var week_year = $('#week_year').val();
		var bulletin_id = $('#bulletin_id').val();
        $.ajax({
			type: 'post',
			url: '<?php echo base_url();?>index.php/epibulletins/download',
			data: {'url':exportUrl,'object':data,'country':country,'week_no':week_no,'week_year':week_year,'bulletin_id':bulletin_id,},
			success: function (data) {
				// Update "src" attribute with received image URL
			   
				
			}
		});
    });


</script>

        </td>
		
		</tr>
		</table>

</td>
</tr>

<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Epidemic situation</strong></font>
		</td>
        <td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Alerts and outbreaks - Epi Week <?php echo $epicalendar->week_no;?></strong></font>
		</td>
		
		</tr>
		<tr>
		<td valign="top">{DATABASE TEXT}
        </td>
        <td valign="top">
        <div id="json_data" style="display:none;">
                            
									 <?php
                                    
                      					echo json_encode($points,JSON_HEX_QUOT | JSON_HEX_TAG);
                                     
                                     ?>
                                     </div>
                                     
                                   
                                   <div id="map-canvas"></div>
                                   
                                 
                                   
                                   <script src="<?php echo base_url(); ?>js/mapwithmarker.js"></script>
                   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        </td>
		
		</tr>
		</table>

</td>
</tr>

<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Epi curve for priority diseases weeks <?php echo $first_week; ?> <?php echo $first_year; ?> to <?php echo $last_week; ?> <?php echo $last_year; ?></strong></font>
		</td>
       
		
		</tr>
		<tr>
		
        <td valign="top">
       	<script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'cont',
                type: 'line'
            },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                categories: [<?php echo $categories; ?>]
            },
            yAxis: {
				min: 0, 
                title: {
                    text: 'Cases'
                }
            },
            tooltip: {
                enabled: true,
                formatter: function() {
                    return '<b>'+ this.series.name +'</b><br/>'+
                        this.x +': '+ this.y +'Cases';
                }
            },
            plotOptions: {
                line: {
                    dataLabels: {
                        enabled: true
                    },
                    enableMouseTracking: true
                }
            },credits: {
      enabled: false
  },
            series: [<?php echo $interestseries; ?>]
        });
    });
    
});
		</script>
        
        <div id="cont" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
        
        
         <!-- For download from highcharts server-->

<script>
// Regular chart options
// Just never rendered with "new Highcharts.Chart" or "$('#container').highcharts()"
var options = {
    chart: {
                renderTo: 'cont',
                type: 'line'
            },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                categories: [<?php echo $categories; ?>]
            },
            yAxis: {
				min: 0, 
                title: {
                    text: 'Cases'
                }
            },
            tooltip: {
                enabled: true,
                formatter: function() {
                    return '<b>'+ this.series.name +'</b><br/>'+
                        this.x +': '+ this.y +'Cases';
                }
            },
            plotOptions: {
                line: {
                    dataLabels: {
                        enabled: true
                    },
                    enableMouseTracking: true
                }
            },credits: {
      enabled: false
  },
            series: [<?php echo $interestseries; ?>]
};


// URL to Highcharts export server
var exportUrl = 'http://export.highcharts.com/';

// POST parameter for Highcharts export server
var object = {
    options: JSON.stringify(options),
    type: 'image/png',
    async: true
};

// Ajax request
$.ajax({
    type: 'post',
    url: exportUrl,
    data: object,
    success: function (data) {
        // Update "src" attribute with received image URL
        //$('#mychart').attr('src', exportUrl + data);
		
    }
}).done(function(data){
		
		var country = $('#country').val();
		var week_no = $('#week_no').val();
		var week_year = $('#week_year').val();
		var bulletin_id = $('#bulletin_id').val();
        $.ajax({
			type: 'post',
			url: '<?php echo base_url();?>index.php/epibulletins/epicurve',
			data: {'url':exportUrl,'object':data,'country':country,'week_no':week_no,'week_year':week_year,'bulletin_id':bulletin_id,},
			success: function (data) {
				// Update "src" attribute with received image URL
			   
				
			}
		});
    });


</script>


        </td>
		
		</tr>
		</table>

</td>
</tr>

<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Number of alerts received and reported (Epi weeks <?php echo $previous_week; ?> and <?php echo $epicalendar->week_no;?>)</strong></font>
		</td>
       
		
		</tr>
		<tr>
		
        <td valign="top">
       	<script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container_sect',
                type: 'column'
            },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                categories: [<?php echo $graphcategories; ?>]
            },
            yAxis: {
                min: 0,
				tickInterval: 5,
                title: {
                    text: 'Number of Alerts'
                }
            },  credits: {
      enabled: false
  },/**
            legend: {
                layout: 'vertical',
                backgroundColor: '#FFFFFF',
                align: 'left',
                verticalAlign: 'top',
                x: 100,
                y: 70,
                floating: true,
                shadow: true
            },**/
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +' ';
                }
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                }
            },
                series: [<?php echo $alertseries; ?>]
        });
    });
    
});
		</script>
        
        
        <div id="container_sect" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
        
          <!-- For download from highcharts server-->

<script>
// Regular chart options
// Just never rendered with "new Highcharts.Chart" or "$('#container').highcharts()"
var options = {
   chart: {
                renderTo: 'container_sect',
                type: 'column'
            },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                categories: [<?php echo $graphcategories; ?>]
            },
            yAxis: {
                min: 0,
				tickInterval: 5,
                title: {
                    text: 'Number of Alerts'
                }
            },  credits: {
      enabled: false
  },/**
            legend: {
                layout: 'vertical',
                backgroundColor: '#FFFFFF',
                align: 'left',
                verticalAlign: 'top',
                x: 100,
                y: 70,
                floating: true,
                shadow: true
            },**/
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +' ';
                }
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                }
            },
                series: [<?php echo $alertseries; ?>]
};


// URL to Highcharts export server
var exportUrl = 'http://export.highcharts.com/';

// POST parameter for Highcharts export server
var object = {
    options: JSON.stringify(options),
    type: 'image/png',
    async: true
};

// Ajax request
$.ajax({
    type: 'post',
    url: exportUrl,
    data: object,
    success: function (data) {
        // Update "src" attribute with received image URL
        //$('#mychart').attr('src', exportUrl + data);
		
    }
}).done(function(data){
		
		var country = $('#country').val();
		var week_no = $('#week_no').val();
		var week_year = $('#week_year').val();
		var bulletin_id = $('#bulletin_id').val();
        $.ajax({
			type: 'post',
			url: '<?php echo base_url();?>index.php/epibulletins/alertgraph',
			data: {'url':exportUrl,'object':data,'country':country,'week_no':week_no,'week_year':week_year,'bulletin_id':bulletin_id,},
			success: function (data) {
				// Update "src" attribute with received image URL
			   
				
			}
		});
    });


</script>
        </td>
		
		</tr>
		</table>

</td>
</tr>

<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Summary of Diseases Reported in weeks <?php echo $previous_week; ?> and <?php echo $epicalendar->week_no;?></strong></font>
		</td>
       
		
		</tr>
		<tr>
		
        <td valign="top">
       	<?php echo $leadingdiseasetable; ?>
        </td>
		
		</tr>
		</table>

</td>
</tr>

<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Trends for confirmed Malaria morbidity in Somalia</strong></font>
		</td>
       
		
		</tr>
		<tr>
		
        <td valign="top">
       	 <script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'malcont',
                zoomType: 'xy'
            },
			  credits: {
      enabled: false
  },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: [{
                categories: [<?php echo $malariacategories;?>]
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    formatter: function() {
                        return this.value +'%';
                    },
                    style: {
                        color: '#89A54E'
                    }
                },
				gridLineWidth: 0,
				minPadding: 0, 
                maxPadding: 0,         
                min: 0, 
                max:100,
                title: {
                    text: 'SPR/FR',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: 'Confirmed Cases',
                    style: {
                        color: '#4572A7'
                    }
                },
                labels: {
                    formatter: function() {
                        return this.value +' ';
                    },
                    style: {
                        color: '#4572A7'
                    }
                },
                opposite: true
            }],
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +
                        (this.series.name == 'Confirmed Cases' ? ' ' : '');
                }
            },/**
            legend: {
                layout: 'vertical',
                align: 'left',
                x: 120,
                verticalAlign: 'top',
                y: 100,
                floating: true,
                backgroundColor: '#FFFFFF'
            },**/
            series: [{
                name: '< 5 Confirmed Cases',
                color: '#892A24',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $malariaufivedata;?>]
    
            }, {
                name: '> 5 Confirmed Cases',
                color: '#4572A7',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $malariaofivedata;?>]
    
            },{
                name: 'SPR',
                color: '#89A54E',
                type: 'spline',
                data: [<?php echo $sprdata;?>]
            }
			,{
                name: 'FR',
                color: '#AA4643',
                type: 'spline',
				dashStyle: 'shortdot',
                data: [<?php echo $frdata;?>]
            }]
        });
    });
    
});
		</script>
        
        <div id="malcont" style="min-width: 300px; height: 300px; margin: 0 auto"></div>
 <!-- For download from highcharts server-->

<script>
// Regular chart options
// Just never rendered with "new Highcharts.Chart" or "$('#container').highcharts()"
var options = {
      credits: {
      enabled: false
  },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: [{
                categories: [<?php echo $malariacategories;?>]
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    formatter: function() {
                        return this.value +'%';
                    },
                    style: {
                        color: '#89A54E'
                    }
                },
				gridLineWidth: 0,
				minPadding: 0, 
                maxPadding: 0,         
                min: 0, 
                max:100,
                title: {
                    text: 'SPR/FR',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: 'Confirmed Cases',
                    style: {
                        color: '#4572A7'
                    }
                },
                labels: {
                    formatter: function() {
                        return this.value +' ';
                    },
                    style: {
                        color: '#4572A7'
                    }
                },
                opposite: true
            }],
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +
                        (this.series.name == 'Confirmed Cases' ? ' ' : '');
                }
            },/**
            legend: {
                layout: 'vertical',
                align: 'left',
                x: 120,
                verticalAlign: 'top',
                y: 100,
                floating: true,
                backgroundColor: '#FFFFFF'
            },**/
            series: [{
                name: '< 5 Confirmed Cases',
                color: '#892A24',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $malariaufivedata;?>]
    
            }, {
                name: '> 5 Confirmed Cases',
                color: '#4572A7',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $malariaofivedata;?>]
    
            },{
                name: 'SPR',
                color: '#89A54E',
                type: 'spline',
                data: [<?php echo $sprdata;?>]
            }
			,{
                name: 'FR',
                color: '#AA4643',
                type: 'spline',
				dashStyle: 'shortdot',
                data: [<?php echo $frdata;?>]
            }]
};


// URL to Highcharts export server
var exportUrl = 'http://export.highcharts.com/';

// POST parameter for Highcharts export server
var object = {
    options: JSON.stringify(options),
    type: 'image/png',
    async: true
};

// Ajax request
$.ajax({
    type: 'post',
    url: exportUrl,
    data: object,
    success: function (data) {
        // Update "src" attribute with received image URL
        //$('#mychart').attr('src', exportUrl + data);
		
    }
}).done(function(data){
		
		var country = $('#country').val();
		var week_no = $('#week_no').val();
		var week_year = $('#week_year').val();
		var bulletin_id = $('#bulletin_id').val();
        $.ajax({
			type: 'post',
			url: '<?php echo base_url();?>index.php/epibulletins/malariagraph',
			data: {'url':exportUrl,'object':data,'country':country,'week_no':week_no,'week_year':week_year,'bulletin_id':bulletin_id,},
			success: function (data) {
				// Update "src" attribute with received image URL
			   
				
			}
		});
    });


</script>
        </td>
		
		</tr>
		</table>

</td>
</tr>

<tr><td>

<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>	Summary of malaria morbidity in week <?php echo $epicalendar->week_no;?> <?php echo $epicalendar->epdyear;?></strong></font>
		</td>
       
		
		</tr>
		<tr>
		
        <td valign="top">
       	 <?php echo $malariatable; ?>
        </td>
		
		</tr>
		</table>

</td>
</tr>

<tr><td>

<?php echo $interesttable; ?>
</td>
</tr>

<tr><td>

<?php echo $lastinteresttable; ?>
</td>
</tr>

<tr><td>

<?php echo $summarytable; ?>
</td>
</tr>

<tr bgcolor="#892A24"><td>
<center>
<font color="#FFFFFF" size="1">*Epi=Epidemiological; Sus=Suspected; HF=Health Facility; <?php
foreach ($diseases->result() as $disease):
	echo $disease->disease_code.'='.$disease->disease_name.'; ';
						
endforeach; 
?>CSR=Communicable disease Surveillance and Response; INT=Insecticides Treated Nets</font>
</center>
</td>
</tr>

<tr bgcolor="#1f7eb8"><td>
<center>
<font color="#FFFFFF" size="1">This weekly Epidemiological bulletin is published jointly by the Health Authorities and the World Health Organization. For further information, please contact the surveillance team on: <?php echo $country->contact_email;?></font>
</center>
</td>
</tr>

</table>


</center>

 <script>
 
var map,
    markerCluster,
    geocoder,
    markers = [],
    image_dir_url = document.body.getAttribute('data-template-url') + '/images/';


// load the maps script
// specify a callback initialize() in the url
function loadScript() {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyABDtmTfMBisFzZ2ajsUlRgDHi95680Xjw&sensor=false&callback=initialize';
  document.body.appendChild(script);
}
window.onload = loadScript;


//will be called after the maps script loads
function initialize(){
  geocoder = new google.maps.Geocoder();
  map = new google.maps.Map(document.getElementById("map-canvas"));
  map.mapTypeId = google.maps.MapTypeId.HYBRID;
  //set options
  //map styles borrowed from: http://snazzymaps.com/style/15/subtle-grayscale
  /**
  
  var kmlUrl = 'http://www.asalforum.or.ke/mappingtool/kml/KenyaCounties.kml';
var kmlOptions = {
  suppressInfoWindows: true,
  preserveViewport: true,
  map: map
};
var kmlLayer = new google.maps.KmlLayer(kmlUrl, kmlOptions);

**/
//var kmzLayer = new google.maps.KmlLayer('http://www.cisp-som.org/drcdbase/drcdbase/kml/SOM_adm2.kmz');
//var kmzLayer = new google.maps.KmlLayer('http://www.asalforum.or.ke/mappingtool/kml/CountiesLayer.kmz');
//var kmzLayer = new google.maps.KmlLayer('http://www.asalforum.or.ke/mappingtool/kml/CountiesKML3.kmz');
//var kmzLayer = new google.maps.KmlLayer('http://www.asalforum.or.ke/mappingtool/kml/kenyacounties.kmz');
//kmzLayer.setMap(map);

  map.setOptions({
    styles : [{"featureType":"landscape","stylers":[{"saturation":-100},{"lightness":65},{"visibility":"on"}]},{"featureType":"poi","stylers":[{"saturation":-100},{"lightness":51},{"visibility":"simplified"}]},{"featureType":"road.highway","stylers":[{"saturation":-100},{"visibility":"simplified"}]},{"featureType":"road.arterial","stylers":[{"saturation":-100},{"lightness":30},{"visibility":"on"}]},{"featureType":"road.local","stylers":[{"saturation":-100},{"lightness":40},{"visibility":"on"}]},{"featureType":"transit","stylers":[{"saturation":-100},{"visibility":"simplified"}]},{"featureType":"administrative.province","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"labels","stylers":[{"visibility":"on"},{"lightness":-25},{"saturation":-100}]},{"featureType":"water","elementType":"geometry","stylers":[{"hue":"#ffff00"},{"lightness":-25},{"saturation":-97}]}]
  });

  // use geolocation web api to get users
  // current location
  if (navigator.geolocation) {
    geolocate();
  }

  // if no latlong defined yet, that means either we
  // were denied access to fetch location or we are on an
  // older browser that doesn't support geoloc api
  if( typeof(latlong) === 'undefined') {
    //fetch the address for Nairobi and center map
    geocoder.geocode({
      'address': '<?php echo $map_center;?>'
    },function(results, status) {
        map.setCenter(results[0].geometry.location);
    });

  }
  
  
  // set the zoom level of the map
  map.setZoom(6);



  //add branch markers to the map
  addMarkers(
    JSON.parse(document.getElementById("json_data").innerHTML)
  );

  var markerCluster = new MarkerClusterer(map, markers);
}


function addMarkers(locations){
  var infowindow = new google.maps.InfoWindow();
  var i;

  for (i = 0; i < locations.length; i++) {
    marker = new google.maps.Marker({
      position: new google.maps.LatLng(locations[i].position.lat, locations[i].position.lng),
      icon: locations[i].icon,
      map: map
    });
	
	
	
	

    google.maps.event.addListener(marker, 'click', (function(marker, i) {
      return function() {
        infowindow.setContent(locations[i].info);
        infowindow.open(map, marker);
      }
    })(marker, i));

    markers.push(marker); //add all markers to this array


  }
}


// geolocate current user
// and add a marker to the map
function geolocate(){
  navigator.geolocation.getCurrentPosition(function(position){

    latlong = {
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };

    map.setCenter(latlong);

    //add a marker to this point
    marker = new google.maps.Marker({
      map: map,
      position: latlong
    });

  });

}

 </script>
</body>
</html>