<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <meta name="viewport" content="width=device-width">
<title>Bulletin</title>
<style>
				#lasttable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#lasttable td, #lasttable th 
				{
				font-size:1.0em;
				border:1px solid #999999;
				padding:3px 7px 2px 7px;
				}
				#lasttable th 
				{
				font-size:1.0em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#lasttable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				
				
				#listtable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:50%;
				border-collapse:collapse;
				}
				#listtable td, #listtable th 
				{
				font-size:1.0em;
				border:1px solid #999999;
				padding:3px 7px 2px 7px;
				}
				#listtable th 
				{
				font-size:1.0em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#listtable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				
				/**/
				#zonlisttable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#zonlisttable td, #zonlisttable th 
				{
				font-size:1.0em;
				border:1px solid #999999;
				padding:3px 7px 2px 7px;
				}
				#zonlisttable th 
				{
				font-size:1.0em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#zonlisttable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                 <style>
        #customers
        {
        font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
        width:100%;
        border-collapse:collapse;
        }
        #customers td, #customers th 
        {
        font-size:0.9em;
        border:2px  solid #fff;
        padding:3px 7px 2px 7px;
        }
        #customers th 
        {
        font-size:1.0em;
        text-align:left;
        padding-top:5px;
        padding-bottom:4px;
        background-color:#cccccc;
        color:#fff;
        }
        #customers tr.alt td 
        {
        color:#000;
        background-color:#cccfff;
        }
        </style>
        
        <style>
				#alertstable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#alertstable td, #alertstable th 
				{
				font-size:0.8em;
				border:1px solid #1F7EB8;
				padding:3px 7px 2px 7px;
				}
				#alertstable th 
				{
				font-size:0.8em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#1F7EB8;
				color:#fff;
				}
				#alertstable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                <style>
				#disttable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#disttable td, #disttable th 
				{
				font-size:0.8em;
				border:1px solid #892A24;
				padding:3px 7px 2px 7px;
				}
				#disttable th 
				{
				font-size:0.8em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#892A24;
				color:#fff;
				}
				#disttable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                
                <style>
				#datatable
				{
				font-family:"Trebuchet MS", Arial, Helvetica, sans-serif;
				width:100%;
				border-collapse:collapse;
				}
				#datatable td, #listtable th 
				{
				font-size:0.9em;
				border:1px solid #892A24;
				padding:3px 7px 2px 7px;
				}
				#datatable th 
				{
				font-size:0.9em;
				text-align:left;
				padding-top:5px;
				padding-bottom:4px;
				background-color:#892A24;
				color:#fff;
				}
				#datatable tr.alt td 
				{
				color:#000;
				background-color:#EAF2D3;
				}
				</style>
                
                
        
      
    <style>
    #map-canvas{
      width: 500px;
      height: 360px;
	    padding: 6px;
        border-width: 1px;
        border-style: solid;
        border-color: #ccc #ccc #999 #ccc;
        -webkit-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        -moz-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        box-shadow: rgba(64, 64, 64, 0.1) 0 2px 5px;
    }
	
	img { max-width:none; }
  </style>

<style>
    #map-canvas{
      width: 500px;
      height: 360px;
	    padding: 6px;
        border-width: 1px;
        border-style: solid;
        border-color: #ccc #ccc #999 #ccc;
        -webkit-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        -moz-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        box-shadow: rgba(64, 64, 64, 0.1) 0 2px 5px;
    }
	
	img { max-width:none; }
</style>
  
<style>
p.mybreak { page-break-before: always; }
</style>
 <script type="text/javascript" language="javascript" src="<?php echo base_url(); ?>media/js/jquery.js"></script>
</head>

<body>
<center>
<table id="listtable">
<tr><td><img src="<?php echo base_url(); ?>images/header.png" alt="" width="100%" height=""></td></tr>
<tr bgcolor="#1f7eb8"><th><center>
<font color="#FFFFFF"><strong> Epi Week <?php echo $epicalendar->week_no;?>, <?php echo date("d F Y", strtotime($epicalendar->from)); ?> - <?php echo date("d F Y", strtotime($epicalendar->to)); ?></strong></font></center>
</th></tr>

<tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Highlights</strong></font>
		</td>
		<td bgcolor="#892A24" width="50%">
		<font color="#FFFFFF"><strong>Reporting rates vs consultations in <?php echo $country->country_name;?>, Epi Weeks <?php echo $first_week; ?> <?php echo $first_year; ?> to <?php echo $last_week; ?> <?php echo $last_year; ?> </strong></font>
		</td>
		</tr>
		<tr>
		<td valign="top"><?php echo $highlight; ?></td>
		<td valign="top">
		<script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'consultationscontainer',
                zoomType: 'xy'
            },
            title: {
                text: ''
            },
			credits: {
      enabled: false
  },
            xAxis: [{
                categories: [<?php echo $categories; ?>]
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    formatter: function() {
                        return this.value ;
                    },
                    style: {
                        color: '#89A54E'
                    }
                },
				gridLineWidth: 0,
				minPadding: 0, 
                maxPadding: 0,         
                min: 0, 
                max:<?php echo $total_facilities; ?>,
                title: {
                    text: 'Reporting Sites',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: 'Consultations',
                    style: {
                        color: '#4572A7'
                    }
                },
                labels: {
                    formatter: function() {
                        return this.value ;
                    },
                    style: {
                        color: '#4572A7'
                    }
                },
                opposite: true
            }],
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +
                        (this.series.name == 'Consultations' ? ' ' : '');
                }
            },
            series: [{
                name: 'Consultations',
                color: '#4572A7',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $consultations_column; ?>]
    
            }, {
                name: 'Reporting Sites',
                color: '#89A54E',
                type: 'spline',
                data: [<?php echo $reporting_sites_column; ?>]
            }]
        });
    });
    
});
		</script>
        
        <div id="consultationscontainer" style="min-width:200px; height: 200px; margin: 0 auto"></div>
        <hr />
        <p><center><font size="-1" color="#1F7EB8">Reporting Rates by <?php echo $country->first_admin_level_label;?>(Epi-week <?php echo $epicalendar->week_no;?>, <?php echo $epicalendar->epdyear;?>)</font></center></p>
        
         <script type="text/javascript">
$(function () {
    $(document).ready(function() {
        var chart = new Highcharts.Chart({
            chart: {
                renderTo: 'distributioncontainer',
                type: 'column'
            },
            title: {
                text: ''
            },
            xAxis: {
                categories: [<?php echo $zonecategories;?>]
            },
            yAxis: {
				
				min: 0,
				max: 100,
				tickInterval: 20,
				title: {
                    text: 'No HF Reports %'
                },
                plotLines:[{
                    value:80,
                    color: '#ff0000',
                    width:2,
                    zIndex:4,
                    label:{text:'Target'}
                }]
            }/**,
			 legend: {
                layout: 'vertical',
                backgroundColor: '#FFFFFF',
                align: 'left',
                verticalAlign: 'top',
                x: 100,
                y: 70,
                floating: true,
                shadow: true
            }**/,  credits: {
      enabled: false
  },
			 labels: {
                    formatter: function() {
                        return this.value +'°%';
                    },
                    style: {
                        color: '#89A54E'
                    }
                },
			tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +' %';
                }
            },
            series: [{
                name: 'Reporting Rate',
                data: [<?php echo $zonereportingrate;?>]
            }]
        });
    });
    
});

		</script>
        <div id="distributioncontainer" style="min-width:200px; height: 210px; margin: 0 auto"></div>
        
        
        
         <script src="<?php echo base_url(); ?>js/highcharts.js"></script>
<script src="<?php echo base_url(); ?>js/exporting.js"></script>

		
		</td>
		</tr>
		</table>
		
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Leading diseases in <?php echo $country->country_name;?> (Epi week <?php echo $epicalendar->week_no;?>)</strong></font></td><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Alerts and outbreaks - Epi Week <?php echo $epicalendar->week_no;?></strong></font></td></tr>
		<tr><td valign="top"><?php echo $leadingDiseasesText; ?>
        <?php echo $leadingdiseasetable;?></td>
		<td valign="top">
         <div id="json_data" style="display:none;">
                            
									 <?php
                                    
                      					echo json_encode($points,JSON_HEX_QUOT | JSON_HEX_TAG);
                                     
                                     ?>
                                     </div>
                                     
                                   
                                   <div id="map-canvas"></div>
                                   
                                 
                                   
                                   <script src="<?php echo base_url(); ?>js/mapwithmarker.js"></script>
                   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
                   
                  <!-- <script src="<?php echo base_url(); ?>js/map.js"></script>-->
		</td></tr>
		
		</table>
		
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Trends for leading priority diseases Epi Weeks <?php echo $first_week; ?> <?php echo $first_year; ?> to <?php echo $last_week; ?> <?php echo $last_year; ?> </strong></font></td><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Proportional Morbidity for Leading Priority Diseases - Epi Week <?php echo $epicalendar->week_no;?>, <?php echo $epicalendar->epdyear;?></strong></font></td></tr>
		<tr><td valign="top">
        <script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'linecontainer',
                type: 'line',
                marginRight: 130,
                marginBottom: 25
            },
            title: {
                text: '',
                x: -20 //center
            },
			credits: {
      enabled: false
  },
            xAxis: {
                categories: [<?php echo $categories; ?>]
            },
            yAxis: {
                title: {
                    text: 'Percentage'
                },
				gridLineWidth: 0,
				minPadding: 0, 
                maxPadding: 0,         
                min: 0,
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                formatter: function() {
                        return '<b>'+ this.series.name +'</b><br/>'+
                        this.x +': '+ this.y +'%';
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                x: -10,
                y: 100,
                borderWidth: 0
            },
            series: [<?php echo $series; ?>]
        });
    });
    
});
		</script>
        
        <div id="linecontainer" style="min-width: 300px; height: 250px; margin: 0 auto"></div>
        
        
        </td>
		<td valign="top">
        
        <script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'propmorbiditycontainer',
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false
            },
            title: {
                text: ''
            },
            tooltip: {
        	    pointFormat: '{series.name}: <b>{point.percentage}%</b>',
            	percentageDecimals: 1
            },  credits: {
      enabled: false
  },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        color: '#000000',
                        connectorColor: '#000000',
                        formatter: function() {
                            return '<b>'+ this.point.name +'</b>: '+ this.percentage.toFixed(1) +' %';
                        }
                    }
                }
            },
            series: [{
                type: 'pie',
                name: 'Proportional Morbidity',
                data: [<?php echo $piedata;?>
                ]
            }]
        });
    });
    
});
		</script>
        <div id="propmorbiditycontainer" style="min-width: 300px; height: 250px; margin: 0 auto"></div>
        
        
		</td></tr>
		
		</table>
		
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Number of alerts received and reported (Epi weeks <?php echo $alert_from_week;?> <?php echo $alert_from_year;?> to <?php echo $alert_to_week;?> <?php echo $alert_to_year;?>)</strong></font></td><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Age and sex distribution of diseases by cases (Epi week <?php echo $epicalendar->week_no;?>, <?php echo $epicalendar->epdyear;?>)</strong></font></td></tr>
		<tr><td valign="top"><script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container_sect',
                type: 'column'
            },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                categories: [<?php echo $graphcategories; ?>]
            },
            yAxis: {
                min: 0,
				tickInterval: 5,
                title: {
                    text: 'Number of Alerts'
                }
            },  credits: {
      enabled: false
  },/**
            legend: {
                layout: 'vertical',
                backgroundColor: '#FFFFFF',
                align: 'left',
                verticalAlign: 'top',
                x: 100,
                y: 70,
                floating: true,
                shadow: true
            },**/
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +' ';
                }
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                }
            },
                series: [<?php echo $alertseries; ?>]
        });
    });
    
});
		</script>
        
        
        <div id="container_sect" style="min-width: 300px; height: 250px; margin: 0 auto"></div></td>
		<td valign="top">
        
        <script>
	/**
 * Grouped Categories v0.0.1 (2013-02-22)
 *
 * (c) 2012-2013 Black Label
 *
 * License: Creative Commons Attribution (CC)
 */
(function(HC){
/*jshint expr:true, boss:true */
var UNDEFINED = void 0,
    mathRound = Math.round,
    mathMin   = Math.min,
    mathMax   = Math.max,

    // cache prototypes
    axisProto  = HC.Axis.prototype,
    tickProto  = HC.Tick.prototype,

    // cache original methods
    _axisInit          = axisProto.init,
    _axisRender        = axisProto.render,
    _axisSetCategories = axisProto.setCategories,
    _tickGetLabelSize  = tickProto.getLabelSize,
    _tickAddLabel      = tickProto.addLabel,
    _tickDestroy       = tickProto.destroy,
    _tickRender        = tickProto.render;


function Category(obj, parent) {
  this.name = obj.name || obj;
  this.parent = parent;

  return this;
}

Category.prototype.toString = function () {
  var parts = [],
      cat = this;

  while (cat) {
    parts.push(cat.name);
    cat = cat.parent;
  }

  return parts.join(', ');
};


// Highcharts methods
function defined(obj) {
  return obj !== UNDEFINED && obj !== null;
}

// calls parseInt with radix = 10, adds 0.5 to avoid blur
function pInt(n) {
  return parseInt(n, 10) - 0.5;
}

// returns sum of an array
function sum(arr) {
  var l = arr.length,
      x = 0;

  while (l--)
    x += arr[l];

  return x;
}


// Builds reverse category tree
function buildTree(cats, out, options, parent, depth) {
  var len = cats.length,
      cat;

  depth || (depth = 0);
  options.depth || (options.depth = 0);

  while (len--) {
    cat = cats[len];


    if (parent)
      cat.parent = parent;


    if (cat.categories)
      buildTree(cat.categories, out, options, cat, depth + 1);

    else
      addLeaf(out, cat, parent);
  }

  options.depth = mathMax(options.depth, depth);
}

// Adds category leaf to array
function addLeaf(out, cat, parent) {
  out.unshift(new Category(cat, parent));

  while (parent) {
    parent.leaves++ || (parent.leaves = 1);
    parent = parent.parent;
  }
}

// Pushes part of grid to path
function addGridPart(path, d) {
  path.push(
    'M',
    pInt(d[0]), pInt(d[1]),
    'L',
    pInt(d[2]), pInt(d[3])
  );
}

// Destroys category groups
function cleanCategory(category) {
  var tmp;

  while (category) {
    tmp = category.parent;

    if (category.label)
      category.label.destroy();

    delete category.parent;
    delete category.label;

    category = tmp;
  }
}

// Returns tick position
function tickPosition(tick, pos) {
  return tick.getPosition(tick.axis.horiz, pos, tick.axis.tickmarkOffset);
}

function walk(arr, key, fn) {
  var l = arr.length,
      children;

  while (l--) {
    children = arr[l][key];

    if (children)
      walk(children, key, fn);

    fn(arr[l]);
  }
}



//
// Axis prototype
//

axisProto.init = function (chart, options) {
  // default behaviour
  _axisInit.call(this, chart, options);

  if (typeof options === 'object' && options.categories)
    this.setupGroups(options);
};

// setup required axis options
axisProto.setupGroups = function (options) {
  var categories  = HC.extend([], options.categories),
      reverseTree = [],
      stats       = {};

  // build categories tree
  buildTree(categories, reverseTree, stats);

  // set axis properties
  this.categoriesTree   = categories;
  this.categories       = reverseTree;
  this.isGrouped        = stats.depth !== 0;
  this.labelsDepth      = stats.depth;
  this.labelsSizes      = [];
  this.labelsGridPath   = [];
  this.tickLength       = options.tickLength || this.tickLength || null;
  this.directionFactor  = [-1, 1, 1, -1][this.side];

  this.options.lineWidth = options.lineWidth || 1;
};


axisProto.render = function () {
  // clear grid path
  if (this.isGrouped)
    this.labelsGridPath = [];

  // cache original tick length
  if (this.originalTickLength === UNDEFINED)
    this.originalTickLength = this.options.tickLength;

  // use default tickLength for not-grouped axis
  // and generate grid on grouped axes,
  // use tiny number to force highcharts to hide tick
  this.options.tickLength = this.isGrouped ? 0.001 : this.originalTickLength;

  _axisRender.call(this);


  if (!this.isGrouped) {
    if (this.labelsGrid)
      this.labelsGrid.attr({visibility: 'hidden'});
    return;
  }

  var axis    = this,
      options = axis.options,
      top     = axis.top,
      left    = axis.left,
      right   = left + axis.width,
      bottom  = top + axis.height,
      visible = axis.hasVisibleSeries,
      depth   = axis.labelsDepth,
      grid    = axis.labelsGrid,
      horiz   = axis.horiz,
      d       = axis.labelsGridPath,
      i       = 0,
      offset  = axis.opposite ? (horiz ? top : right) : (horiz ? bottom : left),
      part;

  if (axis.userTickLength)
    depth -= 1;

  // render grid path for the first time
  if (!grid) {
    grid = axis.labelsGrid = axis.chart.renderer.path()
      .attr({
        strokeWidth: options.lineWidth,
        stroke: options.lineColor
      })
      .add(axis.axisGroup);
  }

  // go through every level and draw horizontal grid line
  while (i <= depth) {
    offset += axis.groupSize(i);

    part = horiz ?
      [left, offset, right, offset] :
      [offset, top, offset, bottom];

    addGridPart(d, part);
    i++;
  }

  // draw grid path
  grid.attr({
    d: d,
    visibility: visible ? 'visible' : 'hidden'
  });

  axis.labelGroup.attr({
    visibility: visible ? 'visible' : 'hidden'
  });


  walk(axis.categoriesTree, 'categories', function (group) {
    var tick = group.tick;

    if (!tick)
      return;

    if (tick.startAt + tick.leaves - 1 < axis.min || tick.startAt > axis.max) {
      tick.label.hide();
      tick.destroyed = 0;
    }
    else
      tick.label.show();
  });
};

axisProto.setCategories = function (newCategories, doRedraw) {
  if (this.categories)
    this.cleanGroups();

  this.setupGroups({
    categories: newCategories
  });

  _axisSetCategories.call(this, this.categories, doRedraw);
};

// cleans old categories
axisProto.cleanGroups = function () {
  var ticks = this.ticks,
      n;

  for (n in ticks)
    if (ticks[n].parent);
      delete ticks[n].parent;

  walk(this.categoriesTree, 'categories', function (group) {
    var tick = group.tick,
        n;

    if (!tick)
      return;

    tick.label.destroy();

    for (n in tick)
      delete tick[n];

    delete group.tick;
  });
};

// keeps size of each categories level
axisProto.groupSize = function (level, position) {
  var positions = this.labelsSizes,
      direction = this.directionFactor;

  if (position !== UNDEFINED)
    positions[level] = mathMax(positions[level] || 0, position + 10);

  if (level === true)
    return sum(positions) * direction;

  else if (positions[level])
    return positions[level] * direction;

  return 0;
};



//
// Tick prototype
//

// Override methods prototypes
tickProto.addLabel = function () {
  var category;

  _tickAddLabel.call(this);

  if (!this.axis.categories ||
      !(category = this.axis.categories[this.pos]))
    return;

  // set label text
  if (category.name)
    this.label.attr('text', category.name);

  // create elements for parent categories
  if (this.axis.isGrouped)
    this.addGroupedLabels(category);
};

// render ancestor label
tickProto.addGroupedLabels = function (category) {
  var tick    = this,
      axis    = this.axis,
      chart   = axis.chart,
      options = axis.options.labels,
      useHTML = options.useHTML,
      css     = options.style,
      attr    = { align: 'center' },
      size    = axis.horiz ? 'height' : 'width',
      depth   = 0,
      label;


  while (tick) {
    if (depth > 0 && !category.tick) {
      // render label element
      label = chart.renderer.text(category.name, 0, 0, useHTML)
        .attr(attr)
        .css(css)
        .add(axis.labelGroup);

      // tick properties
      tick.startAt = this.pos;
      tick.childCount = category.categories.length;
      tick.leaves = category.leaves;
      tick.visible = this.childCount;
      tick.label = label;

      // link tick with category
      category.tick = tick;
    }

    // set level size
    axis.groupSize(depth, tick.label.getBBox()[size]);

    // go up to the parent category
    category = category.parent;

    if (category)
      tick = tick.parent = category.tick || {};
    else
      tick = null;

    depth++;
  }
};

// set labels position & render categories grid
tickProto.render = function (index, old) {
  _tickRender.call(this, index, old);

  if (!this.axis.isGrouped || !this.axis.categories[this.pos] || this.pos > this.axis.max)
    return;

  var tick    = this,
      group   = tick,
      axis    = tick.axis,
      tickPos = tick.pos,
      isFirst = tick.isFirst,
      max     = axis.max,
      min     = axis.min,
      horiz   = axis.horiz,
      cat     = axis.categories[tickPos],
      grid    = axis.labelsGridPath,
      size    = axis.groupSize(0),
      tickLen = axis.tickLength || size,
      factor  = axis.directionFactor,
      xy      = tickPosition(tick, tickPos),
      start   = horiz ? xy.y : xy.x,
      depth   = 1,
      gridAttrs,
      lvlSize,
      attrs,
      bBox;

  // render grid for "normal" categories (first-level), render left grid line only for the first category
  if (isFirst) {
    gridAttrs = horiz ?
      [axis.left, xy.y, axis.left, xy.y + axis.groupSize(true)] :
      axis.isXAxis ?
        [xy.x, axis.top, xy.x + axis.groupSize(true), axis.top] :
        [xy.x, axis.top + axis.len, xy.x + axis.groupSize(true), axis.top + axis.len];

    addGridPart(grid, gridAttrs);
  }

  gridAttrs = horiz ?
    [xy.x, xy.y, xy.x, xy.y + size] :
    [xy.x, xy.y, xy.x + size, xy.y];

  addGridPart(grid, gridAttrs);

  size = start + size;



  while (group = group.parent) {
    minPos  = tickPosition(tick, mathMax(group.startAt - 1, min - 1));
    maxPos  = tickPosition(tick, mathMin(group.startAt + group.leaves - 1, max));
    bBox    = group.label.getBBox();
    lvlSize = axis.groupSize(depth);

    attrs = horiz ? {
      x: (minPos.x + maxPos.x) / 2,
      y: bBox.height * factor + size + 4
    } : {
      x: size,
      y: (minPos.y + maxPos.y + bBox.height) / 2
    };

    group.label.attr(attrs);

    if (grid) {
      gridAttrs = horiz ?
        [maxPos.x, size, maxPos.x, size + lvlSize] :
        [size, maxPos.y, size + lvlSize, maxPos.y];

      addGridPart(grid, gridAttrs);
    }

    size += lvlSize;
    depth++;
  }
};

tickProto.destroy = function () {
  var group = this;

  while (group = group.parent)
    group.destroyed++ || (group.destroyed = 1);

  _tickDestroy.call(this);
};

// return size of the label (height for horizontal, width for vertical axes)
tickProto.getLabelSize = function () {
  if (this.axis.isGrouped === true)
    return sum(this.axis.labelsSizes);
  else
    return _tickGetLabelSize.call(this);
};

}(Highcharts));
$(function () {
    var chart = new Highcharts.Chart({
        chart: {
            renderTo: "categorycont",
            type: "column"
        },
        title: {
            text: null
        },  credits: {
      enabled: false
  },
        series: [<?php echo $caseseries;?>],
        xAxis: {
            categories: [{
                name: "Age",
                categories: ["<5yrs", ">5yrs"]
            }, {
                name: "Sex",
                categories: ["Male", "Female"]
            }]
        },
            yAxis: {
                min: 0,
				tickInterval: 50,
                title: {
                    text: 'Percentages'
                }
            },  credits: {
      enabled: false
  }
    });
});
</script>
 <div id="categorycont" style="min-width: 300px; height: 250px; margin: 0 auto"></div>
        
		</td></tr>
		
		</table>
		
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Trends for confirmed Malaria morbidity in <?php echo $country->country_name;?></strong></font></td><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Summary of malaria morbidity in week <?php echo $epicalendar->week_no;?> <?php echo $epicalendar->epdyear;?></strong></font></td></tr>
		<tr><td valign="top">
         <script type="text/javascript">
$(function () {
    var chart;
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'cont',
                zoomType: 'xy'
            },
			  credits: {
      enabled: false
  },
            title: {
                text: ''
            },
            subtitle: {
                text: ''
            },
            xAxis: [{
                categories: [<?php echo $malariacategories;?>]
            }],
            yAxis: [{ // Primary yAxis
                labels: {
                    formatter: function() {
                        return this.value +'%';
                    },
                    style: {
                        color: '#89A54E'
                    }
                },
				gridLineWidth: 0,
				minPadding: 0, 
                maxPadding: 0,         
                min: 0, 
                max:100,
                title: {
                    text: 'SPR/FR',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, { // Secondary yAxis
                title: {
                    text: 'Confirmed Cases',
                    style: {
                        color: '#4572A7'
                    }
                },
                labels: {
                    formatter: function() {
                        return this.value +' ';
                    },
                    style: {
                        color: '#4572A7'
                    }
                },
                opposite: true
            }],
            tooltip: {
                formatter: function() {
                    return ''+
                        this.x +': '+ this.y +
                        (this.series.name == 'Confirmed Cases' ? ' ' : '');
                }
            },/**
            legend: {
                layout: 'vertical',
                align: 'left',
                x: 120,
                verticalAlign: 'top',
                y: 100,
                floating: true,
                backgroundColor: '#FFFFFF'
            },**/
            series: [{
                name: '< 5 Confirmed Cases',
                color: '#892A24',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $malariaufivedata;?>]
    
            }, {
                name: '> 5 Confirmed Cases',
                color: '#4572A7',
                type: 'column',
                yAxis: 1,
                data: [<?php echo $malariaofivedata;?>]
    
            },{
                name: 'SPR',
                color: '#89A54E',
                type: 'spline',
                data: [<?php echo $sprdata;?>]
            }
			,{
                name: 'FR',
                color: '#AA4643',
                type: 'spline',
				dashStyle: 'shortdot',
                data: [<?php echo $frdata;?>]
            }]
        });
    });
    
});
		</script>
        
        <div id="cont" style="min-width: 300px; height: 300px; margin: 0 auto"></div>
        
        </td>
		<td valign="top">
        <?php echo $malariatable; ?>
        
		</td></tr>
		
		</table>
		
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>{DB HEADING}</strong></font></td><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Number of alerts & outbreaks reported and investigated with appropriate response</strong></font></td></tr>
		<tr><td valign="top">{DB TEXT}</td>
		<td valign="top">
        <?php echo $alertsoutbraketable; ?>
		</td></tr>
		
		</table>
		
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr><td bgcolor="#892A24" width="50%"><font color="#FFFFFF"><strong>Distribution of consultations of leading diseases by zone, Epiweek <?php echo $epicalendar->week_no;?></strong></font></td></tr>
		<tr>
		<td valign="top">
        <?php echo $distributiontable; ?>
        
		</td></tr>
		
		</table>
		
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">
		<tr><td>
		<?php  echo $zonestable; ?>
		</td></tr>
        </table>
		</td></tr>
        
        <tr><td>
		<table width="100%" cellpadding="3" cellspacing="2" id="customers">

		<tr><td bgcolor="#892A24"><font color="#FFFFFF"><strong>Alerts/Outbreaks Reported in Epi Week <?php echo $epicalendar->week_no;?>, <?php echo $epicalendar->epdyear;?></strong></font></td></tr>
		<tr>
		<td valign="top"><?php
		echo $consolidatedtable;
		?>
		</td></tr>
        </table>
        </td></tr>
        
        	<tr bgcolor="#892A24"><td><center>
<font color="#FFFFFF" size="1">*Epi=Epidemiological; Sus=Suspected; AFP=Acute Flaccid Paralysis; NNT=Neonatal Tetanus; HF=Health Facility; WPV = Wild Polio Virus; CSR=Communicable disease Surveillance and ResponseI; INT=Insecticides Treated Nets</font>
</center></td></tr>
		
		<tr bgcolor="#1f7eb8"><td><center>
<font color="#FFFFFF" size="1">This weekly Epidemiological bulletin is published jointly by the Health Authorities and the World Health Organization. For further information, please contact the surveillance team on: ajangaa@nbo.emro.who.int</font>
</center></td></tr>

</table>


</center>

 <script>
 
var map,
    markerCluster,
    geocoder,
    markers = [],
    image_dir_url = document.body.getAttribute('data-template-url') + '/images/';


// load the maps script
// specify a callback initialize() in the url
function loadScript() {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyABDtmTfMBisFzZ2ajsUlRgDHi95680Xjw&sensor=false&callback=initialize';
  document.body.appendChild(script);
}
window.onload = loadScript;


//will be called after the maps script loads
function initialize(){
  geocoder = new google.maps.Geocoder();
  map = new google.maps.Map(document.getElementById("map-canvas"));
  map.mapTypeId = google.maps.MapTypeId.HYBRID;
  //set options
  //map styles borrowed from: http://snazzymaps.com/style/15/subtle-grayscale
  /**
  
  var kmlUrl = 'http://www.asalforum.or.ke/mappingtool/kml/KenyaCounties.kml';
var kmlOptions = {
  suppressInfoWindows: true,
  preserveViewport: true,
  map: map
};
var kmlLayer = new google.maps.KmlLayer(kmlUrl, kmlOptions);

**/
//var kmzLayer = new google.maps.KmlLayer('http://www.cisp-som.org/drcdbase/drcdbase/kml/SOM_adm2.kmz');
//var kmzLayer = new google.maps.KmlLayer('http://www.asalforum.or.ke/mappingtool/kml/CountiesLayer.kmz');
//var kmzLayer = new google.maps.KmlLayer('http://www.asalforum.or.ke/mappingtool/kml/CountiesKML3.kmz');
//var kmzLayer = new google.maps.KmlLayer('http://www.asalforum.or.ke/mappingtool/kml/kenyacounties.kmz');
//kmzLayer.setMap(map);

  map.setOptions({
    styles : [{"featureType":"landscape","stylers":[{"saturation":-100},{"lightness":65},{"visibility":"on"}]},{"featureType":"poi","stylers":[{"saturation":-100},{"lightness":51},{"visibility":"simplified"}]},{"featureType":"road.highway","stylers":[{"saturation":-100},{"visibility":"simplified"}]},{"featureType":"road.arterial","stylers":[{"saturation":-100},{"lightness":30},{"visibility":"on"}]},{"featureType":"road.local","stylers":[{"saturation":-100},{"lightness":40},{"visibility":"on"}]},{"featureType":"transit","stylers":[{"saturation":-100},{"visibility":"simplified"}]},{"featureType":"administrative.province","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"labels","stylers":[{"visibility":"on"},{"lightness":-25},{"saturation":-100}]},{"featureType":"water","elementType":"geometry","stylers":[{"hue":"#ffff00"},{"lightness":-25},{"saturation":-97}]}]
  });

  // use geolocation web api to get users
  // current location
  if (navigator.geolocation) {
    geolocate();
  }

  // if no latlong defined yet, that means either we
  // were denied access to fetch location or we are on an
  // older browser that doesn't support geoloc api
  if( typeof(latlong) === 'undefined') {
    //fetch the address for Nairobi and center map
    geocoder.geocode({
      'address': '<?php echo $map_center;?>'
    },function(results, status) {
        map.setCenter(results[0].geometry.location);
    });

  }
  
  
  // set the zoom level of the map
  map.setZoom(6);



  //add branch markers to the map
  addMarkers(
    JSON.parse(document.getElementById("json_data").innerHTML)
  );

  var markerCluster = new MarkerClusterer(map, markers);
}


function addMarkers(locations){
  var infowindow = new google.maps.InfoWindow();
  var i;

  for (i = 0; i < locations.length; i++) {
    marker = new google.maps.Marker({
      position: new google.maps.LatLng(locations[i].position.lat, locations[i].position.lng),
      icon: locations[i].icon,
      map: map
    });
	
	
	
	

    google.maps.event.addListener(marker, 'click', (function(marker, i) {
      return function() {
        infowindow.setContent(locations[i].info);
        infowindow.open(map, marker);
      }
    })(marker, i));

    markers.push(marker); //add all markers to this array


  }
}


// geolocate current user
// and add a marker to the map
function geolocate(){
  navigator.geolocation.getCurrentPosition(function(position){

    latlong = {
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };

    map.setCenter(latlong);

    //add a marker to this point
    marker = new google.maps.Marker({
      map: map,
      position: latlong
    });

  });

}

 </script>
</body>
</html>